<div class="header-wrapper"><style data-emotion-css="cz947x">.css-cz947x:not(:last-child){margin-bottom:8px;}</style><h1 class="css-cz947x ei8t6h40">Files</h1></div><hr><style data-emotion-css="1yp4ln">.css-1yp4ln{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1yp4ln e1llsqps0"><style data-emotion-css="a181dj">.css-a181dj{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;width:0;}.css-a181dj .api-ref h4 code{font-size:1.1em;}.css-a181dj .api-ref *:not(pre) > code[class*="language-"]{padding:0;background:none;}</style><div class="css-a181dj e1llsqps1"><style data-emotion-css="1f43zf7">.css-1f43zf7 a[href]:not([class]){color:#1053a0;-webkit-text-decoration:none;text-decoration:none;}.css-1f43zf7 a[href]:not([class]):hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-1f43zf7 a[href]:not([class]) code{color:inherit;}.css-1f43zf7 h1 code,.css-1f43zf7 h2 code,.css-1f43zf7 h3 code,.css-1f43zf7 h4 code,.css-1f43zf7 h5 code,.css-1f43zf7 h6 code{white-space:normal;}.css-1f43zf7 h1 a,.css-1f43zf7 h2 a,.css-1f43zf7 h3 a,.css-1f43zf7 h4 a,.css-1f43zf7 h5 a,.css-1f43zf7 h6 a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-1f43zf7 h1 a:hover,.css-1f43zf7 h2 a:hover,.css-1f43zf7 h3 a:hover,.css-1f43zf7 h4 a:hover,.css-1f43zf7 h5 a:hover,.css-1f43zf7 h6 a:hover{color:#5A6270;}.css-1f43zf7 *:not(style) + h2,.css-1f43zf7 *:not(style) + h3,.css-1f43zf7 *:not(style) + h4,.css-1f43zf7 *:not(style) + h5{margin-top:64px;}.css-1f43zf7 img{display:block;max-width:100%;}.css-1f43zf7 .mermaid svg{max-width:100%;}</style><div class="content-wrapper css-1f43zf7 e1llsqps2"><p>Close users wishing to attach files to outgoing emails or other objects via the Close API must first upload these files using the Files API.</p><p>Files will be uploaded to a Close-provided <a href="https://aws.amazon.com/pm/serv-s3/" target="_blank" rel="noopener noreferrer">Amazon S3</a> bucket.
The Close API provides the data needed to make a request to S3 to store your file.</p><p>To do so:</p><ol><li>Make a POST request to <code class="language-text">/files/upload/</code> with the <code class="language-text">filename</code> and <code class="language-text">content_type</code> of the file you are uploading.</li><li>Use the data in the response to construct a <code class="language-text">multipart/form-data</code> POST request:
The request should be to the URL provided in the <code class="language-text">upload.url</code>.
All fields in the <code class="language-text">upload.fields</code> object must be included in the form fields of the request.
This request must be made within 60 seconds of your request to <code class="language-text">/files/upload</code>, otherwise it will fail.
See the <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTForms.html" target="_blank" rel="noopener noreferrer">AWS documentation</a> for more information.</li><li>Once the upload request has been made successfully (201 HTTP status code), the file will be available for use in other API endpoints for at most 24 hours.
The response from <code class="language-text">/files/upload</code> will contain a <code class="language-text">download.url</code> field, whose value should be used when referencing this file in other API endpoints.
Note: attempting to use this file before the S3 upload request has been made successfully will result in a failed request to the Close API.</li></ol><p>The below sample code can be used to make the request to S3. This example uses the <code class="language-text">requests</code> library in Python.</p><div class="gatsby-highlight" data-language="python"><style data-emotion-css="1gcd36t">.css-1gcd36t{margin-bottom:1.45rem;border:1px solid #DEE2E7;border-radius:4px;}</style><div class="css-1gcd36t e1ulzjg70"><style data-emotion-css="1y4makq">.css-1y4makq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding:4px;border-bottom:1px solid #DEE2E7;}</style><div class="css-1y4makq e1ulzjg71"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><style data-emotion-css="r8v8pb">.css-r8v8pb{padding:15px;background-color:#F4F6F8;overflow:auto;}</style><div class="css-r8v8pb e1ulzjg73"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">from</span> closeio_api <span class="token keyword">import</span> Client
<span class="token keyword">import</span> requests

api <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token string">"YOUR_API_KEY"</span><span class="token punctuation">)</span>
files_upload_response <span class="token operator">=</span> api<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"files/upload"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token string">"image.jpg"</span><span class="token punctuation">,</span>
    <span class="token string">"content_type"</span><span class="token punctuation">:</span> <span class="token string">"image/jpeg"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Use the data in the response to construct a multipart/form-data POST request</span>
s3_upload_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    files_upload_response<span class="token punctuation">[</span><span class="token string">"upload"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    data<span class="token operator">=</span>files_upload_response<span class="token punctuation">[</span><span class="token string">"upload"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"fields"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    files<span class="token operator">=</span><span class="token punctuation">{</span>
      <span class="token string">"file"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">"image.jpg"</span><span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"path/to/image.jpg"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">assert</span> s3_upload_response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">201</span>

<span class="token comment"># The file will be available for use in other API endpoints, for example below</span>
<span class="token comment"># when creating an email activity.</span>
email_create_response <span class="token operator">=</span> api<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"activity/email"</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">"attachments"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">"url"</span><span class="token punctuation">:</span> files_upload_response<span class="token punctuation">[</span><span class="token string">"download"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token string">"image.jpg"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token punctuation">:</span> <span class="token number">1108447</span><span class="token punctuation">,</span>
        <span class="token string">"content_type"</span><span class="token punctuation">:</span> <span class="token string">"image/jpeg"</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"contact_id"</span><span class="token punctuation">:</span> <span class="token string">"cont_8NNOJnVwmHQEYuVOgJ4B4zU7g9RUxYH4JnPjza5Vr6t"</span><span class="token punctuation">,</span>
    <span class="token string">"lead_id"</span><span class="token punctuation">:</span> <span class="token string">"lead_KwD00BYbXCHiPWj68LxFkxaeWuULpZ7awzm6LqeFs0h"</span><span class="token punctuation">,</span>
    <span class="token string">"user_id"</span><span class="token punctuation">:</span> <span class="token string">"user_scOgjLAQD6aBSJYBVhIeNr6FJDp8iDTug8Mv6VqYoFn"</span><span class="token punctuation">,</span>
    <span class="token string">"direction"</span><span class="token punctuation">:</span> <span class="token string">"outgoing"</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h2 id="generate-a-signed-s3-post" style="position:relative"><a class="headingLink" href="#generate-a-signed-s3-post">Generate a signed S3 POST</a></h2><p><code class="language-text">POST /files/upload/</code></p><p>Get the data needed to make a request to S3 to store your file.</p><style data-emotion-css="1yul8ea">.css-1yul8ea{margin-bottom:1.45rem;border-left:2px solid #1053a0;}</style><div class="css-1yul8ea e1yz1yf60"><style data-emotion-css="18j0rgo">.css-18j0rgo{border:1px solid #CAD0D8;border-left:0;border-top-right-radius:4px;border-bottom-right-radius:4px;}</style><div class="css-18j0rgo e1yz1yf61"><style data-emotion-css="112bfcp">.css-112bfcp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;padding:12px 16px;border:0;font-size:16px;color:#1053a0;line-height:calc(5/3);text-align:left;background:none;outline:none;cursor:pointer;}.css-112bfcp:hover{background-color:rgba(0,0,0,0.05);}.css-112bfcp:active{background-color:rgba(0,0,0,0.1);}.css-112bfcp svg{height:14px;width:14px;margin-right:12px;}</style><button class="css-112bfcp e1yz1yf62"><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg>Example Request/Response</button></div></div></div><style data-emotion-css="9ckfit">.css-9ckfit{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:64px 0;}@media (max-width:850px){.css-9ckfit{padding:32px 0;}}</style><nav class="css-9ckfit e1sfxy7w0"><style data-emotion-css="spe9v1">.css-spe9v1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-spe9v1 svg{height:16px;width:16px;}.css-spe9v1:hover{opacity:0.8;}</style><a class="css-spe9v1 e1sfxy7w1" href="/resources/phone-numbers/"><svg viewBox="0 0 14 24" class="css-1a134qk"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.5.75L1.78 11.47a.749.749 0 0 0-.001 1.059l.001.001L12.5 23.25"></path></svg><style data-emotion-css="16mhdhi">.css-16mhdhi{margin-left:24px;text-align:left;}@media (max-width:850px){.css-16mhdhi{margin-left:16px;}}</style><div class="css-16mhdhi e1sfxy7w2"><style data-emotion-css="1vhhq4p">.css-1vhhq4p{-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;font-size:12px;}</style><div class="css-1vhhq4p e1sfxy7w3">Previous</div><style data-emotion-css="mtbysh">.css-mtbysh{color:#2F353F;}</style><div class="css-mtbysh e1sfxy7w4">Phone Numbers</div></div></a><a style="margin-left:auto" class="css-spe9v1 e1sfxy7w1" href="/resources/comments/"><style data-emotion-css="18eg9eb">.css-18eg9eb{margin-right:24px;text-align:right;}@media (max-width:850px){.css-18eg9eb{margin-right:16px;}}</style><div class="css-18eg9eb e1sfxy7w2"><div class="css-1vhhq4p e1sfxy7w3">Next</div><div class="css-mtbysh e1sfxy7w4">Comments</div></div><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.5.75l10.72 10.72a.749.749 0 0 1 .001 1.059l-.001.001L5.5 23.25"></path></svg></a></nav></div><style data-emotion-css="u6jpbo">.css-u6jpbo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:240px;max-height:calc(100vh - 72px);margin-top:-36px;padding:40px 0;margin-left:40px;position:-webkit-sticky;position:sticky;top:72px;}@media (max-width:1120px){.css-u6jpbo{display:none;}}@media (max-width:850px){.css-u6jpbo{display:block;}}@media (max-width:600px){.css-u6jpbo{display:none;}}</style><aside class="css-u6jpbo e1llsqps3"><style data-emotion-css="35ezg3">.css-35ezg3{font-weight:600;}</style><h4 class="css-35ezg3 e1llsqps4">Files</h4><style data-emotion-css="1b603mp">.css-1b603mp{margin-left:0;margin-bottom:48px;overflow:auto;}</style><ul class="css-1b603mp e1wyoreh0"><style data-emotion-css="1jgp2cw">.css-1jgp2cw{list-style:none;font-size:1rem;line-height:inherit;}.css-1jgp2cw.active{color:#1053a0;font-weight:bold;}.css-1jgp2cw a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-1jgp2cw a:hover{opacity:0.8;}</style><li class=" css-1jgp2cw e1wyoreh1" style="padding-left:"><a href="#generate-a-signed-s3-post">Generate a signed S3 POST</a></li></ul></aside></div>